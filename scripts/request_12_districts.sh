#!/usr/bin/env bash
# scripts/request_12_districts.sh
set -euo pipefail

API_BASE="${API_BASE:-http://localhost:5000}"

# --- å°åŒ—å¸‚12è¡Œæ”¿å€ä¸­å¿ƒé» ---
declare -A DISTRICTS=(
  ["ä¸­æ­£å€"]="25.03240487,121.5198839"
  ["å¤§åŒå€"]="25.06342433,121.5130417"
  ["ä¸­å±±å€"]="25.06969917,121.5381597"
  ["æ¾å±±å€"]="25.05999101,121.5575876"
  ["å¤§å®‰å€"]="25.02677012,121.5434446"
  ["è¬è¯å€"]="25.0285899,121.4979858"
  ["ä¿¡ç¾©å€"]="25.03062083,121.5716697"
  ["å£«æ—å€"]="25.12546704,121.5508473"
  ["åŒ—æŠ•å€"]="25.1480682,121.5177992"
  ["å…§æ¹–å€"]="25.08370623,121.5923828"
  ["å—æ¸¯å€"]="25.03600934,121.6097573"
  ["æ–‡å±±å€"]="24.98857934,121.5736082"
)

echo "===> å‘ ${API_BASE}/aqi/pm25 ç™¼é€ 12 å€æ¸¬è©¦è«‹æ±‚ ($(date '+%F %T'))"
for name in "${!DISTRICTS[@]}"; do
  IFS=',' read -r lat lon <<<"${DISTRICTS[$name]}"
  echo "ğŸ“¡ ${name} (${lat}, ${lon})"
  curl -s "${API_BASE}/aqi/pm25?lat=${lat}&lon=${lon}" | jq -r '"  \(.input.lat),\(.input.lon) -> AQI:\(.aqi_pm25) (\(.aqi_category))"' || true
  sleep 1
done
echo "âœ… å…¨éƒ¨è«‹æ±‚å®Œæˆã€‚"

